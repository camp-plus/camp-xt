<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CAMP-XT One-click Installer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:24px;background:#111;color:#eee}button{font-size:16px;padding:12px 16px;border-radius:8px;border:none;background:#2d8cff;color:#fff;cursor:pointer}pre{white-space:pre-wrap;background:#0b0b0b;padding:12px;border-radius:8px;overflow:auto}</style>
  </head>
  <body>
    <h1>CAMP-XT One-click Installer</h1>
    <p>This page opens the latest <code>overlay-all.user.js</code> directly so your userscript manager can install it.</p>
    <p>
      <button id="install">Install via CDN (latest)</button>
      <button id="install-raw" style="margin-left:8px;background:#666">Install via Raw (no-cache)</button>
      <button id="install-pinned" style="margin-left:8px;background:#2d9955">Install pinned to latest commit</button>
      <button id="view" style="margin-left:8px;background:#444">View source</button>
    </p>
    <pre id="log" style="display:none"></pre>
    <script>
  const owner = 'camp-plus';
  const repo = 'camp-xt';
  const cdnUrl = `https://cdn.jsdelivr.net/gh/${owner}/${repo}@main/scripts/overlay-all.user.js`;
  const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/main/scripts/overlay-all.user.js`;

      document.getElementById('install').addEventListener('click', () => {
        window.open(cdnUrl + '?_=' + Date.now(), '_blank', 'noopener');
      });

      document.getElementById('install-raw').addEventListener('click', () => {
        window.open(rawUrl + '?_=' + Date.now(), '_blank', 'noopener');
      });

      async function getLatestCommitSha() {
        const api = `https://api.github.com/repos/${owner}/${repo}/commits/main`;
        const res = await fetch(api, { cache: 'no-store' });
        if (!res.ok) throw new Error('GitHub API error: ' + res.status);
        const data = await res.json();
        return data && (data.sha || (data.commit && data.commit.tree && data.commit.tree.sha));
      }

      document.getElementById('install-pinned').addEventListener('click', async () => {
        const log = document.getElementById('log');
        log.style.display = 'block';
        log.textContent = 'Resolving latest commit...';
        try {
          const sha = await getLatestCommitSha();
          if (!sha) throw new Error('No SHA found');
          const pinned = `https://raw.githubusercontent.com/${owner}/${repo}/${sha}/scripts/overlay-all.user.js`;
          log.textContent = 'Opening pinned script @ ' + sha.slice(0, 7) + '...';
          window.open(pinned + '?_=' + Date.now(), '_blank', 'noopener');
        } catch (e) {
          log.textContent = 'Pinned install error: ' + (e && e.message ? e.message : String(e));
        }
      });

      document.getElementById('view').addEventListener('click', async () => {
        const log = document.getElementById('log');
        log.style.display = 'block';
        try {
          const res = await fetch(cdnUrl + '?_=' + Date.now(), { cache: 'no-store' });
          const ok = res && res.ok ? res : await fetch(rawUrl + '?_=' + Date.now(), { cache: 'no-store' });
          const text = await ok.text();
          const w = window.open();
          w.document.write('<pre>' + escapeHtml(text) + '</pre>');
          w.document.close();
        } catch (e) {
          log.textContent = 'View error: ' + (e && e.message ? e.message : String(e));
        }
      });

      function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    </script>
  </body>
</html>
