<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CAMP-XT One-click Installer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:24px;background:#111;color:#eee}button{font-size:16px;padding:12px 16px;border-radius:8px;border:none;background:#2d8cff;color:#fff;cursor:pointer}pre{white-space:pre-wrap;background:#0b0b0b;padding:12px;border-radius:8px;overflow:auto}</style>
  </head>
  <body>
    <h1>CAMP-XT One-click Installer</h1>
    <p>This page will fetch the latest <code>overlay-all.user.js</code> directly from the repository with a cache-busting request and open it so your userscript manager can install it.</p>
    <p>
      <button id="install">Fetch &amp; Install latest</button>
      <button id="view" style="margin-left:8px;background:#444">View source</button>
    </p>
    <pre id="log" style="display:none"></pre>
    <script>
      const rawUrl = 'https://raw.githubusercontent.com/camp-plus/camp-xt/main/scripts/overlay-all.user.js';

      async function fetchAndOpen() {
        const log = document.getElementById('log');
        try {
          log.style.display = 'block';
          log.textContent = 'Fetching latest script...';
          const res = await fetch(rawUrl, { cache: 'no-store', credentials: 'omit' });
          if (!res.ok) throw new Error('Fetch failed: ' + res.status);
          const text = await res.text();
          log.textContent = 'Fetched ' + text.length + ' bytes. Preparing installer...';

          // Create a blob and open in a new tab. Userscript managers will detect and offer to install.
          const blob = new Blob([text], { type: 'text/javascript' });
          const url = URL.createObjectURL(blob);
          // Open the blob URL in a new tab â€” most userscript managers handle this as an install.
          window.open(url, '_blank');
          log.textContent += '\nOpened installer in a new tab.';
          // Revoke after a short delay
          setTimeout(() => URL.revokeObjectURL(url), 2000);
        } catch (err) {
          log.textContent = 'Error: ' + (err && err.message ? err.message : String(err));
        }
      }

      document.getElementById('install').addEventListener('click', fetchAndOpen);
      document.getElementById('view').addEventListener('click', async () => {
        const res = await fetch(rawUrl + '?_=' + Date.now(), { cache: 'no-store' });
        const t = await res.text();
        const w = window.open();
        w.document.write('<pre>' + escapeHtml(t) + '</pre>');
        w.document.close();
      });

      function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    </script>
  </body>
</html>
