<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CAMP-XT One-click Installer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:24px;background:#111;color:#eee}
      button{font-size:16px;padding:12px 16px;border-radius:8px;border:none;background:#2d8cff;color:#fff;cursor:pointer}
      pre{white-space:pre-wrap;background:#0b0b0b;padding:12px;border-radius:8px;overflow:auto}
      a { color:#9ad; }
    </style>
  </head>
  <body>
    <h1>CAMP-XT One-click Installer</h1>
    <p>This page opens the latest <code>overlay-all.user.js</code> directly so your userscript manager can install it.</p>
    <p>
      <button id="install">Install via CDN (latest)</button>
      <button id="install-raw" style="margin-left:8px;background:#666">Install via Raw (no-cache)</button>
      <button id="view" style="margin-left:8px;background:#444">View source</button>
    </p>
    <pre id="log" style="display:none"></pre>
    <script>
      const cdnUrl = 'https://cdn.jsdelivr.net/gh/camp-plus/camp-xt@main/scripts/overlay-all.user.js';
      const rawUrl = 'https://raw.githubusercontent.com/camp-plus/camp-xt/main/scripts/overlay-all.user.js';

      document.getElementById('install').addEventListener('click', () => {
        // Direct open via CDN with cache-busting query so managers detect and install
        window.open(cdnUrl + '?_=' + Date.now(), '_blank', 'noopener');
      });

      document.getElementById('install-raw').addEventListener('click', () => {
        // Fallback: raw GitHub (no CDN cache), also triggers install in most managers
        window.open(rawUrl + '?_=' + Date.now(), '_blank', 'noopener');
      });

      document.getElementById('view').addEventListener('click', async () => {
        const log = document.getElementById('log');
        log.style.display = 'block';
        try {
          const res = await fetch(cdnUrl + '?_=' + Date.now(), { cache: 'no-store' });
          const ok = res && res.ok ? res : await fetch(rawUrl + '?_=' + Date.now(), { cache: 'no-store' });
          const text = await ok.text();
          const w = window.open();
          w.document.write('<pre>' + escapeHtml(text) + '</pre>');
          w.document.close();
        } catch (e) {
          log.textContent = 'View error: ' + (e && e.message ? e.message : String(e));
        }
      });

      function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    </script>
  </body>
  </html>
